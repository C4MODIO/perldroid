#summary How to compile perl-5.16.0 for Android using the SVN version of this project
#labels Featured

=How to compile perl-5.16.0 for Android=

Follow these steps to build the project as it is today (2012-06-21). I made the checkout to get r241 on purpose, because following commits may change the build sequence.

This works on an Ubuntu 12.04 server 64 bit just installed with only openssh-server (tested on a fresh install in a virtual machine). Please follow these steps carefully, especially for the `cd` commands because the working directory is important.

  # Be sure host is up to date
{{{
sudo apt-get update && sudo apt-get dist-upgrade
# reboot if necessary
}}}
  # Install required packages (include `ia32-libs` only if you use a 64 bit OS)
{{{
sudo apt-get --no-install-recommends install build-essential subversion ia32-libs
}}}
  # To cross compile perl, the host should provide the same version of the executable than the one being cross compiled. As Ubuntu 12.04 provides perl 5.14.2, we need to install perl 5.16.0 from source on the host.*Note: As said, this will install perl 5.16.0 in /usr/local on your host. This is mainly why I prefered to do that in a virtual machine instead of my own host.*
{{{
wget -nd http://www.cpan.org/src/5.0/perl-5.16.0.tar.gz
tar xzf perl-5.16.0.tar.gz
cd perl-5.16.0/
./Configure -des -Dinstallprefix=/usr/local
make
sudo make install
cd
mv perl-5.16.0 perl-5.16.0.host
}}}
  # Get the Android NDK (SDK not necessary)
{{{
wget -nd http://dl.google.com/android/ndk/android-ndk-r8-linux-x86.tar.bz2
tar xjf android-ndk-r8-linux-x86.tar.bz2
ln -s android-ndk-r8 android-ndk
export NDK=~/android-ndk
}}}
  # Install now the standalone toolchain
{{{
$NDK/build/tools/make-standalone-toolchain.sh --platform=android-14 --install-dir=$HOME/android_toolchain
PATH=~/android_toolchain/bin:$PATH
}}}
  # Next step is untar again perl source
{{{
tar xzf perl-5.16.0.tar.gz
}}}
  # Now get the PerlDroid source
{{{
svn checkout http://perldroid.googlecode.com/svn/trunk/@241 perldroid
cd ~/perldroid/libperl/perl-5.16.0/Cross
}}}
  # There is a script to automate the patching of the perl source tree. Edit it and comment or remove the line 7 (`exit 0`). This step is to force you to know what the script does
{{{
vi prepare_perl_from_svn.sh
}}}
  # launch the script
{{{
./prepare_perl_from_svn.sh
}}}
  # Copy / paste the last 2 output lines:
{{{
cd ~/perl-5.16.0/Cross/
make -f Makefile.android perl
}}}
The last step above will start the compilation. This will take some time and display a lot of messages. On my system it takes approximatively 5 minutes. The 3 last output lines should be:
{{{
...
cd /home/mid/perl-5.16.0/Cross/.. ; sh -x Cross/warp
+ find lib -name install_me_here
+ find lib -name install_me_here
}}}
with the username being yours. There should be no error, of course.

The compiled distribution can now be found in the directory `~/perl-5.16.0/install_me_here/`.

More information is coming to talk about APK integration with the [http://code.google.com/p/perl-android-apk/ perl-android-apk] project.
----
Â© _Mid'_, 2012 ;-)